<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Reeha - Keşif ve Kayıt</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">

<style>
    body { margin: 0; padding: 0; background: #000; overflow: hidden; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    
    .top-bar {
        position: absolute; top: 0; left: 0; width: 100%; height: 80px;
        background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%);
        z-index: 100; display: flex; align-items: center; padding: 0 25px;
    }

    .back-btn {
        color: white; text-decoration: none; font-family: serif;
        letter-spacing: 2px; font-size: 11px; opacity: 0.6; transition: 0.3s;
        margin-right: 30px;
    }

    /* Fotoğraf Penceresi (Popup) Tasarımı */
    .mapboxgl-popup-content {
        background: rgba(0, 0, 0, 0.9) !important;
        color: white !important;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 0 !important;
        padding: 15px !important;
        font-family: serif;
    }
    .mapboxgl-popup-close-button { color: white !important; }
    
    .popup-img {
        width: 100%;
        max-width: 250px;
        height: auto;
        display: block;
        margin-bottom: 10px;
        border: 1px solid rgba(255,255,255,0.1);
    }

    /* Özel İşaretçi (Pin) Tasarımı */
    .custom-marker {
        width: 15px;
        height: 15px;
        border: 2px solid white;
        border-radius: 50%;
        background: rgba(255,255,255,0.2);
        cursor: pointer;
        box-shadow: 0 0 15px rgba(255,255,255,0.5);
    }

    .mapboxgl-ctrl-geocoder { background-color: rgba(255, 255, 255, 0.05) !important; border: 1px solid rgba(255, 255, 255, 0.2) !important; border-radius: 0 !important; }
    .mapboxgl-ctrl-geocoder--input { color: white !important; }
    .mapboxgl-ctrl-bottom-right, .mapboxgl-ctrl-bottom-left { display: none; }
</style>
</head>
<body>

<div class="top-bar">
    <a href="index.html" class="back-btn">← ANA SAYFA</a>
    <div id="geocoder"></div>
</div>

<div id="map"></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiYWRlbTk5MTciLCJhIjoiY21rMDF6YXNjNmNtYzNlczU5YTUyYXUzMCJ9.mjaJaz3MfODoSZrL2wVKJw';
    
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-v9', 
        projection: 'globe', 
        zoom: 2,
        center: [28.97, 41.00],
        antialias: true
    });

    const geocoder = new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        mapboxgl: mapboxgl,
        marker: false,
        placeholder: 'FOTOĞRAF EKLEMEK İSTEDİĞİN YERİ ARA...',
        zoom: 16
    });

    document.getElementById('geocoder').appendChild(geocoder.onAdd(map));

    // Manuel olarak fotoğraf ekleme fonksiyonu (Örnek Data)
    function addPhotoMarker(lng, lat, imageUrl, title) {
        const el = document.createElement('div');
        el.className = 'custom-marker';

        const popup = new mapboxgl.Popup({ offset: 25 })
            .setHTML(`
                <img src="${imageUrl}" class="popup-img">
                <div style="text-align:center; letter-spacing:1px;">${title}</div>
            `);

        new mapboxgl.Marker(el)
            .setLngLat([lng, lat])
            .setPopup(popup)
            .addTo(map);
    }

    // Haritaya tıklandığında oraya bir pin at (Şimdilik örnek fotoğraf koyar)
    map.on('click', (e) => {
        const lngLat = e.lngLat;
        // Burada normalde bir dosya seçme penceresi açılabilir
        // Şimdilik sistemin nasıl çalıştığını görmen için rastgele bir görsel koyuyoruz
        addPhotoMarker(lngLat.lng, lngLat.lat, 'https://picsum.photos/400/300', 'YENİ KEŞİF');
    });

    // Otomatik Dönüş Durdurma
    let isSpinning = true;
    const stopSpinning = () => { isSpinning = false; };
    map.on('mousedown', stopSpinning);
    map.on('wheel', stopSpinning);
    geocoder.on('result', stopSpinning);

    function rotateGlobe() {
        if (isSpinning && map.getZoom() < 5) {
            const center = map.getCenter();
            center.lng -= 0.15;
            map.easeTo({ center, duration: 0, easing: (n) => n });
        }
    }
    map.on('moveend', () => { if (isSpinning) rotateGlobe(); });
    map.on('style.load', () => {
        map.setFog({ 'color': '#000', 'high-color': '#000', 'space-color': '#000' });
        rotateGlobe();
        
        // BAŞLANGIÇTA ÖRNEK BİR NOKTA EKLEYELİM (İstanbul)
        addPhotoMarker(28.97, 41.00, 'https://images.unsplash.com/photo-1524231757912-21f4fe3a7200', 'İSTANBUL KOLEKSİYONU');
    });
</script>

</body>
</html>
